"""
Test script to verify coach panel translations without database connection.
This script tests only the translation functionality for coach panel buttons and messages.
"""

import sys
import os

# Add the src directory to the Python path
current_dir = os.path.dirname(os.path.abspath(__file__))
project_root = os.path.dirname(current_dir)
src_path = os.path.join(project_root, "src")
sys.path.insert(0, src_path)

from easy_track.i18n.translator import translator


def test_coach_translations():
    """Test that all coach panel translations work correctly."""
    print("üîç Testing Coach Panel Translations (No Database)")
    print("=" * 55)

    # Test translation keys for Ukrainian
    user_lang = "uk"
    print(f"\nüá∫üá¶ Testing Ukrainian translations (lang: {user_lang})")
    print("-" * 45)

    # Test button translations that were fixed
    button_tests = [
        {
            "key": "coach.buttons.my_athletes",
            "expected": "üë• –ú–æ—ó —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∏",
            "description": "My Athletes button"
        },
        {
            "key": "coach.buttons.view_athlete_details",
            "expected": "üìä –î–µ—Ç–∞–ª—ñ {name}",
            "description": "Athlete details button (parameterized)",
            "params": {"name": "–Ü–≤–∞–Ω"},
            "expected_with_params": "üìä –î–µ—Ç–∞–ª—ñ –Ü–≤–∞–Ω"
        },
        {
            "key": "buttons.back_to_coach_panel",
            "expected": "üîô –ù–∞–∑–∞–¥ –¥–æ –ø–∞–Ω–µ–ª—ñ —Ç—Ä–µ–Ω–µ—Ä–∞",
            "description": "Back to Coach Panel button"
        },
        {
            "key": "buttons.cancel",
            "expected": "‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏",
            "description": "Cancel button"
        },
        {
            "key": "coach.buttons.add_athlete",
            "expected": "‚ûï –î–æ–¥–∞—Ç–∏ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞",
            "description": "Add Athlete button"
        },
        {
            "key": "coach.buttons.remove_athlete",
            "expected": "üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞",
            "description": "Remove Athlete button"
        },
        {
            "key": "coach.buttons.coach_panel",
            "expected": "üéØ –ü–∞–Ω–µ–ª—å —Ç—Ä–µ–Ω–µ—Ä–∞",
            "description": "Coach Panel button"
        },
        {
            "key": "coach.buttons.view_all_progress",
            "expected": "üìä –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å",
            "description": "View All Progress button"
        }
    ]

    print("üîò Testing button translations:")
    all_passed = True

    for test in button_tests:
        try:
            if "params" in test:
                # Test parameterized translation
                actual = translator.get(test["key"], user_lang, **test["params"])
                expected = test["expected_with_params"]
            else:
                # Test simple translation
                actual = translator.get(test["key"], user_lang)
                expected = test["expected"]

            if actual == expected:
                print(f"  ‚úÖ {test['description']}: '{actual}'")
            else:
                print(f"  ‚ùå {test['description']}:")
                print(f"      Key: {test['key']}")
                print(f"      Expected: '{expected}'")
                print(f"      Got:      '{actual}'")
                all_passed = False
        except Exception as e:
            print(f"  ‚ùå {test['description']}: ERROR - {e}")
            print(f"      Key: {test['key']}")
            all_passed = False

    # Test message translations
    message_tests = [
        {
            "key": "coach.panel.title",
            "expected": "üéØ **–ü–∞–Ω–µ–ª—å —Ç—Ä–µ–Ω–µ—Ä–∞**\n\n–û–±–µ—Ä—ñ—Ç—å –¥—ñ—é:",
            "description": "Coach Panel title"
        },
        {
            "key": "coach.remove_athlete.select",
            "expected": "üë• **–í–∏–¥–∞–ª–∏—Ç–∏ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞**\n\n–û–±–µ—Ä—ñ—Ç—å —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞ —è–∫–æ–≥–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∑ –≤–∞—à–æ–≥–æ –Ω–∞–≥–ª—è–¥—É:",
            "description": "Remove athlete selection message"
        },
        {
            "key": "coach.list_athletes.no_athletes",
            "expected": "üë• –£ –≤–∞—Å –ø–æ–∫–∏ –Ω–µ–º–∞—î —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤.\n–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ /add_athlete —â–æ–± –¥–æ–¥–∞—Ç–∏ –ø–µ—Ä—à–æ–≥–æ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞!",
            "description": "No athletes message"
        }
    ]

    print("\nüîò Testing message translations:")
    for test in message_tests:
        try:
            actual = translator.get(test["key"], user_lang)
            expected = test["expected"]

            if actual.strip() == expected.strip():
                print(f"  ‚úÖ {test['description']}")
            else:
                print(f"  ‚ùå {test['description']}:")
                print(f"      Key: {test['key']}")
                print(f"      Expected: '{expected}'")
                print(f"      Got:      '{actual}'")
                all_passed = False
        except Exception as e:
            print(f"  ‚ùå {test['description']}: ERROR - {e}")
            print(f"      Key: {test['key']}")
            all_passed = False

    # Test English translations for comparison
    print(f"\nüá∫üá∏ Testing English translations (lang: en)")
    print("-" * 45)

    english_tests = [
        {
            "key": "coach.buttons.my_athletes",
            "expected": "üë• My Athletes",
            "description": "My Athletes button (EN)"
        },
        {
            "key": "buttons.back_to_coach_panel",
            "expected": "üîô Back to Coach Panel",
            "description": "Back to Coach Panel button (EN)"
        },
        {
            "key": "buttons.cancel",
            "expected": "‚ùå Cancel",
            "description": "Cancel button (EN)"
        }
    ]

    print("üîò Testing English button translations:")
    for test in english_tests:
        try:
            actual = translator.get(test["key"], "en")
            expected = test["expected"]

            if actual == expected:
                print(f"  ‚úÖ {test['description']}: '{actual}'")
            else:
                print(f"  ‚ùå {test['description']}:")
                print(f"      Key: {test['key']}")
                print(f"      Expected: '{expected}'")
                print(f"      Got:      '{actual}'")
                all_passed = False
        except Exception as e:
            print(f"  ‚ùå {test['description']}: ERROR - {e}")
            print(f"      Key: {test['key']}")
            all_passed = False

    return all_passed


def test_fixed_issues():
    """Test specific issues that were fixed."""
    print(f"\nüîß Testing Fixed Issues")
    print("-" * 25)

    issues_fixed = [
        "‚úÖ Hardcoded 'Back to Coach Panel' ‚Üí translated button",
        "‚úÖ Hardcoded 'üìä {name}' ‚Üí 'coach.buttons.view_athlete_details'",
        "‚úÖ Hardcoded 'Cancel' ‚Üí translated 'buttons.cancel'",
        "‚úÖ Hardcoded 'Remove Athlete' message ‚Üí translated message",
        "‚úÖ All coach panel buttons now use translation system",
    ]

    for issue in issues_fixed:
        print(f"  {issue}")

    print(f"\nüéØ Key Changes Made:")
    changes = [
        "‚Ä¢ bot.py line 640: Added translator.get('buttons.back_to_coach_panel')",
        "‚Ä¢ bot.py line 665: Added translator.get('buttons.back_to_coach_panel')",
        "‚Ä¢ bot.py line 735: Added translator.get('coach.buttons.view_athlete_details')",
        "‚Ä¢ bot.py line 769: Added translator.get('buttons.back_to_coach_panel')",
        "‚Ä¢ bot.py line 418: Added translator.get('coach.buttons.my_athletes')",
        "‚Ä¢ bot.py line 1297: Added translator.get('buttons.cancel')",
        "‚Ä¢ bot.py line 1304: Added translator.get('coach.remove_athlete.select')",
        "‚Ä¢ Multiple other instances of 'Back to Coach Panel' fixed",
    ]

    for change in changes:
        print(f"  {change}")


def simulate_user_experience():
    """Simulate the user experience with translations."""
    print(f"\nüé≠ Simulating User Experience")
    print("-" * 35)

    user_lang = "uk"

    scenarios = [
        {
            "step": "1. User opens coach panel",
            "translation": translator.get("coach.panel.title", user_lang),
            "expected_contains": "–ü–∞–Ω–µ–ª—å —Ç—Ä–µ–Ω–µ—Ä–∞"
        },
        {
            "step": "2. User clicks 'My Athletes'",
            "translation": translator.get("coach.buttons.my_athletes", user_lang),
            "expected_contains": "–ú–æ—ó —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∏"
        },
        {
            "step": "3. User sees athlete '–Ü–≤–∞–Ω' button",
            "translation": translator.get("coach.buttons.view_athlete_details", user_lang, name="–Ü–≤–∞–Ω"),
            "expected_contains": "–î–µ—Ç–∞–ª—ñ –Ü–≤–∞–Ω"
        },
        {
            "step": "4. User wants to go back",
            "translation": translator.get("buttons.back_to_coach_panel", user_lang),
            "expected_contains": "–ù–∞–∑–∞–¥ –¥–æ –ø–∞–Ω–µ–ª—ñ —Ç—Ä–µ–Ω–µ—Ä–∞"
        },
        {
            "step": "5. User wants to cancel action",
            "translation": translator.get("buttons.cancel", user_lang),
            "expected_contains": "–°–∫–∞—Å—É–≤–∞—Ç–∏"
        }
    ]

    print("üéÆ User journey simulation:")
    all_scenarios_passed = True

    for scenario in scenarios:
        try:
            translation = scenario["translation"]
            expected = scenario["expected_contains"]

            if expected in translation:
                print(f"  ‚úÖ {scenario['step']}")
                print(f"      Shows: '{translation}'")
            else:
                print(f"  ‚ùå {scenario['step']}")
                print(f"      Expected to contain: '{expected}'")
                print(f"      Got: '{translation}'")
                all_scenarios_passed = False
        except Exception as e:
            print(f"  ‚ùå {scenario['step']}: ERROR - {e}")
            all_scenarios_passed = False

    return all_scenarios_passed


if __name__ == "__main__":
    print("üöÄ EasySize Coach Panel Translation Test")
    print("=" * 50)

    try:
        # Test translations
        translations_passed = test_coach_translations()

        # Test fixed issues
        test_fixed_issues()

        # Simulate user experience
        scenarios_passed = simulate_user_experience()

        # Summary
        print(f"\nüìä Test Results Summary")
        print("=" * 30)

        if translations_passed and scenarios_passed:
            print("üéâ ‚úÖ ALL TESTS PASSED!")
            print("\nüèÜ Successfully Fixed Issues:")
            print("  ‚Ä¢ Coach athlete selection buttons now show Ukrainian text")
            print("  ‚Ä¢ 'Back to Coach Panel' buttons properly translated")
            print("  ‚Ä¢ 'Cancel' buttons use Ukrainian translation")
            print("  ‚Ä¢ Athlete detail buttons use formatted Ukrainian text")
            print("  ‚Ä¢ Remove athlete selection uses Ukrainian messages")
            print("  ‚Ä¢ Consistent user experience in Ukrainian language")

            print("\nüéØ Before vs After:")
            print("  ‚ùå Before: 'Back to Coach Panel' (hardcoded English)")
            print("  ‚úÖ After:  'üîô –ù–∞–∑–∞–¥ –¥–æ –ø–∞–Ω–µ–ª—ñ —Ç—Ä–µ–Ω–µ—Ä–∞' (translated)")
            print("  ‚ùå Before: 'üìä {name}' (hardcoded format)")
            print("  ‚úÖ After:  'üìä –î–µ—Ç–∞–ª—ñ {name}' (translated format)")
            print("  ‚ùå Before: 'Cancel' (hardcoded English)")
            print("  ‚úÖ After:  '‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏' (translated)")

        else:
            print("‚ö†Ô∏è ‚ùå SOME TESTS FAILED!")
            if not translations_passed:
                print("  ‚Ä¢ Translation tests failed")
            if not scenarios_passed:
                print("  ‚Ä¢ User scenario tests failed")

        print(f"\nüìù Next Steps:")
        print("   1. Start the bot: make docker-run")
        print("   2. Set language to Ukrainian: /language")
        print("   3. Become a coach: /become_coach")
        print("   4. Open menu: /menu")
        print("   5. Click 'üéØ –ü–∞–Ω–µ–ª—å —Ç—Ä–µ–Ω–µ—Ä–∞'")
        print("   6. Verify all buttons show Ukrainian text")
        print("   7. Test athlete selection and back navigation")

    except Exception as e:
        print(f"‚ùå Test failed with error: {e}")
        import traceback
        traceback.print_exc()
